<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mackey-Glass Forecasting on GPU · ReservoirComputing.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://reservoircomputing.sciml.ai/stable/esn_tutorials/mackeyglass_basic/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ReservoirComputing.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ReservoirComputing.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">ReservoirComputing.jl</a></li><li><span class="tocitem">General Settings</span><ul><li><a class="tocitem" href="../../general/different_training/">Changing Training Algorithms</a></li><li><a class="tocitem" href="../../general/states_variation/">Altering States</a></li><li><a class="tocitem" href="../../general/predictive_generative/">Generative vs Predictive</a></li></ul></li><li><span class="tocitem">Echo State Network Tutorials</span><ul><li><a class="tocitem" href="../lorenz_basic/">Lorenz System Forecasting</a></li><li class="is-active"><a class="tocitem" href>Mackey-Glass Forecasting on GPU</a><ul class="internal"><li><a class="tocitem" href="#Downloading-the-Data"><span>Downloading the Data</span></a></li><li><a class="tocitem" href="#Building-the-Echo-State-Network"><span>Building the Echo State Network</span></a></li><li><a class="tocitem" href="#Training-and-Prediction"><span>Training and Prediction</span></a></li></ul></li><li><a class="tocitem" href="../change_layers/">Using Different Layers</a></li><li><a class="tocitem" href="../different_drivers/">Using Different Reservoir Drivers</a></li><li><a class="tocitem" href="../deep_esn/">Deep Echo State Networks</a></li><li><a class="tocitem" href="../hybrid/">Hybrid Echo State Networks</a></li></ul></li><li><a class="tocitem" href="../../reca_tutorials/reca/">Reservoir Computing with Cellular Automata</a></li><li><span class="tocitem">API Documentation</span><ul><li><a class="tocitem" href="../../api/training/">Training Algorithms</a></li><li><a class="tocitem" href="../../api/states/">States Modifications</a></li><li><a class="tocitem" href="../../api/predict/">Prediction Types</a></li><li><a class="tocitem" href="../../api/esn/">Echo State Networks</a></li><li><a class="tocitem" href="../../api/esn_layers/">ESN Layers</a></li><li><a class="tocitem" href="../../api/esn_drivers/">ESN Drivers</a></li><li><a class="tocitem" href="../../api/reca/">ReCA</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Echo State Network Tutorials</a></li><li class="is-active"><a href>Mackey-Glass Forecasting on GPU</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mackey-Glass Forecasting on GPU</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/ReservoirComputing.jl/blob/master/docs/src/esn_tutorials/mackeyglass_basic.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mackey-Glass-Time-Series-Forecasting-on-the-GPU"><a class="docs-heading-anchor" href="#Mackey-Glass-Time-Series-Forecasting-on-the-GPU">Mackey Glass Time Series Forecasting on the GPU</a><a id="Mackey-Glass-Time-Series-Forecasting-on-the-GPU-1"></a><a class="docs-heading-anchor-permalink" href="#Mackey-Glass-Time-Series-Forecasting-on-the-GPU" title="Permalink"></a></h1><p>This second introductory example showcases the ability of Echo State Networks (ESNs) to forecast another simple low dimensional complex system, but this time the calculations will be performed on the GPU. More specifically this example uses the <a href="http://www.scholarpedia.org/article/Mackey-Glass_equation">Mackey Glass</a> chaotic time series. The data and parameters for the following code are taken from dr. Mantas Lukoševičius&#39;s <a href="https://mantas.info/">website</a> and they are going to be compared with the <a href="https://mantas.info/wp/wp-content/uploads/simple_esn/minimalESN.jl">minimalESN.jl</a> code he provides in it. The full script for this example is available <a href="https://github.com/MartinuzziFrancesco/reservoir-computing-examples/blob/main/mackeyglass_basic/mackeyglass_basic.jl">here</a>. This example was run on Julia v1.7.2.</p><h2 id="Downloading-the-Data"><a class="docs-heading-anchor" href="#Downloading-the-Data">Downloading the Data</a><a id="Downloading-the-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Downloading-the-Data" title="Permalink"></a></h2><p>Instead of leveraging DifferentialEquations.jl this example downloads directly the data from the website. </p><pre><code class="language-julia hljs">using Downloads, DelimitedFiles, CUDA

data_path = Downloads.download(&quot;https://mantas.info/wp/wp-content/uploads/simple_esn/MackeyGlass_t17.txt&quot;, 
    string(pwd(),&quot;/MackeyGlass_t17.txt&quot;))
data = CuArray(reduce(hcat, convert(Matrix{Float32}, readdlm(data_path, &#39;,&#39;))))</code></pre><p>Once the data has been obtained it is time to split it into the needed datasets. In the Lorenz example the initial transient of the data was excluded using a <code>shift</code> parameter. In this case the ESN itself is going to be washing out the initial data, so a different parameter <code>washout</code> is needed. This needs to be taken into consideration when splitting the data, in order to adjust the target data accordingly.</p><pre><code class="language-julia hljs">washout      = 100
train_len    = 2000
predict_len  = 2000

input_data   = data[:, 1:train_len]
target_data  = data[:, washout+2:train_len+1]
test_data    = data[:, train_len+2:train_len+predict_len+1]</code></pre><h2 id="Building-the-Echo-State-Network"><a class="docs-heading-anchor" href="#Building-the-Echo-State-Network">Building the Echo State Network</a><a id="Building-the-Echo-State-Network-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-Echo-State-Network" title="Permalink"></a></h2><p>Now that the data has been split into the needed datasets it is necessary to create the ESN. The input layer and matrix construction is a copy-paste from Mantas&#39;s code. This section also showcases how it is possible to feed custom built matrices into the <code>ESN</code> constructor, without the need to rely exclusively on the reservoirs and layers included in the library.</p><p>In addition this example makes use of the <code>PaddedExtendedStates()</code> states type. It is also important to point out that the <code>washout</code> parameter need to be passed at this stage. The size of the input layer is the size of the input data, one in this case, plus one, to adjust the dimensions for the padding. Since the padding is equal to unity in this example is possible to not pass any value into the states constructor, since the default is 1.0.</p><pre><code class="language-julia hljs">using ReservoirComputing, Random, LinearAlgebra

Random.seed!(42)
res_size = 1000

esn = ESN(input_data; 
    variation = Default(),
    reservoir = RandSparseReservoir(res_size, 1.25, 1.0),
    input_layer = WeightedLayer(1.0),
    reservoir_driver = RNN(leaky_coefficient=0.3),
    nla_type = NLADefault(),
    states_type = PaddedExtendedStates(),
    washout=washout)</code></pre><h2 id="Training-and-Prediction"><a class="docs-heading-anchor" href="#Training-and-Prediction">Training and Prediction</a><a id="Training-and-Prediction-1"></a><a class="docs-heading-anchor-permalink" href="#Training-and-Prediction" title="Permalink"></a></h2><p>The training and prediction are similar to the previous example of the Lorenz system. The ESN is going to be trained in one shot using ridge regression. The prediction type is generative, so the predicted value from the model will be fed back into itself. </p><pre><code class="language-julia hljs">training_method = StandardRidge(1e-8) 
output_layer    = train(esn, target_data, training_method)    
output          = esn(Generative(predict_len), output_layer)</code></pre><p>In order to assess if the prediction is comparable to the minimalESN code it suffice to run:</p><pre><code class="language-julia hljs">println(sum(abs2.(test_data[:,1:500] .- output[:,1:500]))/500)</code></pre><pre><code class="nohighlight hljs">9.488587078654942e-7</code></pre><p>This result is comparable to the value from the minimalESN.jl that is 1.6798044273046558e-6. It could also be helpful to visualize the results:</p><pre><code class="language-julia hljs">using Plots

plot([test_data&#39; output&#39;], label = [&quot;actual&quot; &quot;predicted&quot;], 
    plot_title=&quot;Makey Glass Time Series&quot;,
    titlefontsize=20,
    legendfontsize=12,
    linewidth=2.5,
    xtickfontsize = 12,
    ytickfontsize = 12,
    size=(1080, 720))</code></pre><p><img src="../images/mackeyglass_basic.png" alt="mackeyglass_basic"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../lorenz_basic/">« Lorenz System Forecasting</a><a class="docs-footer-nextpage" href="../change_layers/">Using Different Layers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 17 September 2022 17:29">Saturday 17 September 2022</span>. Using Julia version 1.8.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
